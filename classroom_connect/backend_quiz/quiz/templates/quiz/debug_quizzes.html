{% extends "quiz/base.html" %}

{% block title %}Quiz Availability Debug{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Quiz Availability Debugging</h1>
    
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">System Information</h5>
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-4">Django Timezone Setting:</dt>
                <dd class="col-sm-8">{{ django_timezone }}</dd>
                
                <dt class="col-sm-4">Current Time (aware):</dt>
                <dd class="col-sm-8">{{ current_time_aware }}</dd>
                
                <dt class="col-sm-4">Current Time (naive):</dt>
                <dd class="col-sm-8">{{ current_time_naive }}</dd>
                
                <dt class="col-sm-4">Daylight Savings Active:</dt>
                <dd class="col-sm-8">{{ is_dst }}</dd>
            </dl>
        </div>
    </div>
    
    <h2>Recent Quizzes</h2>
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Visible?</th>
                    <th>Start Date</th>
                    <th>Deadline</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for quiz in quiz_debug_info %}
                <tr class="{% if not quiz.is_visible %}table-danger{% endif %}">
                    <td>{{ quiz.id }}</td>
                    <td>{{ quiz.title }}</td>
                    <td>
                        {% if quiz.is_visible %}
                            <span class="badge badge-success">Visible</span>
                        {% else %}
                            <span class="badge badge-danger">Hidden</span>
                        {% endif %}
                    </td>
                    <td>
                        {{ quiz.start_date }}
                        {% if quiz.start_date_naive %}
                            <span class="badge badge-warning">Naive</span>
                        {% endif %}
                    </td>
                    <td>
                        {{ quiz.complete_by_date }}
                        {% if quiz.complete_by_naive %}
                            <span class="badge badge-warning">Naive</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if not quiz.is_active %}
                            <span class="badge badge-secondary">Inactive</span>
                        {% elif quiz.is_ended %}
                            <span class="badge badge-dark">Ended</span>
                        {% else %}
                            <span class="badge badge-primary">Active</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'quiz:debug_quiz_detail' quiz.id %}" class="btn btn-sm btn-info">Details</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="alert alert-info mt-4">
        <h5>Fixing Quiz Date Issues</h5>
        <p>If you see quizzes marked with "Naive" dates, you can fix them by running:</p>
        <pre class="bg-dark text-white p-2">python manage.py fix_quiz_dates</pre>
    </div>
</div>
{% endblock %}